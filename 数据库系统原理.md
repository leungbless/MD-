# 数据库系统原理



## 1. 数据库系统概述



### 1.1 数据库的基本概念



1. 数据（描述事物的符号记录）
2. 数据库（数据的集合）**永久存储，有组织，可共享**
3. 数据库管理系统（建立和管理数据库的一套软件）介于应用程序和操作系统之间



---

### 1.2 数据管理技术的发展



1. 人工管理阶段（记录内无结构，整体无结构）
2. 文件系统阶段
3. 数据库系统阶段



---

### 1.3 数据库系统的结构

三级模式两层映像

1. 模式 （相当于数据库的结构）
   * 数据库中全体数据的逻辑结构或特征描述，是所有用户的公共数据视图
   * 一个数据库只有一个模式，且相对稳定

2. 外模式（相当于使用数据时的结构）
   * 数据库用户能够看到和使用的**局部**数据的逻辑结构和特征的描述，是与某一应用有关的数据的逻辑表示
   * DBMS提供子模式描述语言来严格定义子模式

3. 内模式（相当于管理库，表，字段的结构）
   * 对数据库中数据物理结构和存储方式的描述，是数据在数据库内部的表示形式

4. 三级模式结构和两层映像与数据独立性
   * 外模式/模式映像（逻辑独立性）
   * 模式/内模式映像（物理独立性）



---

### 1.4 数据库系统的运行与应用结构



1. 客户/服务器（C/S）模式
   * 比如：QQ，桌面客户端游戏
2. 浏览器/服务器（B/S）模式
   * 网站，在线Web游戏



---

### 1.5 数据特征与数据模型的组成要素



数据模型的组成要素：

1. 数据结构
   * 描述系统的静态特性，数据对象的数据类型，内容，属性等。
2. 数据操作
   * 描述系统的动态特性，对各种对象实例允许执行的操作集合。
3. 数据约束
   * 描述数据结构中数据间语法和语义的关联，包括相对制约或者依存等待，来保证数据的正确性。



#### 1.5.1 概念层数据模型



基本概念：

1. 实体
   * 客观存在的东西
2. 属性
   * 东西的特征
3. 码（键）
   * 可以唯一标识实体的属性集合
4. 域
   * 属性的取值范围
5. 实体型
   * 实体名和属性名的集合标识同类实体
   * 比如 ：学生（姓名，年龄，性别）
6. 实体集
   * 同型实体的集合
   * 比如 ：所有的学生
7. 联系
   * 实体内部之间的联系和实体之间的联系
   * 一对一，一对多，多对一





概念模型的表示方式：E-R图

![sjk1.png](http://yanxuan.nosdn.127.net/455fa791f72353c1debb60e7a4b92e7f.png)





#### 1.5.2 逻辑层数据模型

1. 层次模型
2. 网状模型
3. ==关系模型==
4. 面向对象模型



#### 1.5.3 物理层数据模型

数据在存储介质上的组织结构，是数据库最底层的抽象，它确定数据的物理存储结构，数据存取路径以及调整，优化数据库的性能。

设计目的：提高数据库性能和有效利用存储空间



---

## 2. 关系数据库



基本术语：

1. 表（Table）
   * 也称==关系==，是一个二维的数据结构，由表名，列，行数据构成。
   * 每个表的表名唯一，每一行描述一条具体的记录值。

2. 关系（Relation）
   * 就是表，关系的三种类型：基本关系，查询表和视图表。

3. 列（Column）
   * 表中的列，也称为==字段==或==属性==，每一列有一个名称，称为列名，字段或属性名。

4. 属性（Attribute）
   * 就是列。

5. 行（Row）
   * 也称为==元组==或==记录==，一行数据即一个元组或一条记录。

6. 元组（Tuple）
   * 就是一行记录。

7. 分量（Component）
   * 元组中的一个属性值称为分量。就是一行数据的某一个数据。

8. 码或键（Key）
   * 唯一标识一行数据的属性或属性组，比如：学号，身份证号。

9. 超码或超键（Super Key）
   * 如果一个关系中的一个码移去某个属性，它仍然是这个关系的码。
   * 比如：（学号，姓名），（学号，姓名，电话），（学号，姓名，身份证号码）

10. 候选码或候选键（Candidate Key）
    * 如果在关系的一个码或键中，不能移去任何一个属性，否则它就不是这个关系的码或键。

11. 主码或主键（Primary Key）
    * 指定一个==候选码==（不一定是一个字段）来唯一标识一行数据。

12. 全码或全键（All-Key）
    * 一个关系中所有属性都是主码或主键。

13. 主属性（Primary Attribute）和非主属性（NonPrimary Attribute）
    * 包含任何一个候选码的属性称为主属性
    * 不包含任何一个候选码的属性称为非主属性

14. 外码或外键（Foreign Key）
    * 某个属性不是这个关系的主码或候选码，而是==另一个关系的主码==，则该属性是外码。

15. 参照关系和被参照关系
    * 以外码作为主码的关系成为被参照关系
    * 外码所在的关系称为参照关系

16. 域（Domain）
    * 属性的取值范围，如（性别：男，女）

17. 数据类型
    * 表示属性的数据类型

18. 关系模式
    * 关系模式是静态的，关系是动态的
    * 关系是关系模型在某一时刻的状态或内容



### 2.1 关系数据库的要求



1. 每一个属性不能继续分解
2. 每一个关系模式中属性的数据类型和属性个数相对固定
3. 同一个关系中不允许雏形候选码相同的两行
4. 行和列可以任意交换



---

### 2.2 基本关系操作



查询类：

* 选择
* 投影
* 连接
* 除
* 并
* 差
* 交
* 笛卡儿积等



数据更新类：

* 插入
* 删除
* 修改



关系操作的特点：集合操作的方式，即操作的对象和结果都是集合。



----
### 2.3 关系数据库的规范化理论



关系模式中可能存在的冗余和异常问题：

* 数据冗余
* 更新异常
* 插入异常
* 删除异常



---

### 2.4 函数依赖与关键字



定义1

> R为任一给定关系，如果对于R中属性X的每一个值，R中的属性Y都只有唯一值与之对应，则称X函数决定Y或称Y函数依赖于X，记作 X->Y。其中X称为决定因素。
>
> 可以分为下面两种：
>
> 1. 完全函数依赖
>
> 设R为任一给定关系，X，Y为其属性集，若X->Y,且对X中的任意真子集X ‘都有X ’ -/->Y ,则称Y完全函数依赖于X。
>
> 2. 部分函数依赖
>
> 设R为任一给定关系，X，Y为其属性集，若X->Y,且X中存在一个真子集X ‘满足X ’ ->Y，则称Y部分函数依赖于X。
>
> 3. 传递函数依赖
>
> 设R为任意给定关系，X，Y，Z为其属性子集，若X->Y, Y -/->X, Y->Z,则X->Z。称Z传递函数依赖于X。



定义2

> 设R为任一给定关系，U为其所含的全部属性集合，X为U的子集，若有完全函数依赖X->U，则X为R的一个候选关键字。



---

### 2.5 1NF 第一范式



每个列和行的交叉点处的取值都是不可再分的基本元素。

---

### 2.6 2NF 第二范式



设R为任一给定的关系，若R为1NF，且所有的非主属性都完全函数依赖于候选关键字。

---

### 2.7 3NF 第三范式



设R为任一给定关系，若R为2NF，且其每一个非主属性都不传递函数依赖于候选关键字。

---

### 2.8 BCNF范式



设R为任一给定的关系，X，Y为其属性集，F为其函数依赖集，若R为3NF，且其F中所有函数依赖X->Y（Y不属于X），中的X必包含候选关键字，则R为BCNF。



---

## 3. SQL与关系数据库的基本操作



### 3.1 内置的函数



1. 数值函数
   * Abs（X），绝对值
   * Sqrt（X），算术平方根

2. 聚合函数
   * Count（X）

3. 字符串函数
   * ASCII（），CHAR（）
4. 日期函数
   * Now（），YEAR（）
5. 加密函数
   * ENCODE（），ENCRYPT（）
6. 控制流程函数
   * IF（），IFNULL（）
7. 格式化函数
   * FORMAT（）
8. 类型转换函数
   * CAST（）
9. 系统信息函数
   * USER（），VERSION（）等





### 3.2 表的数据类型

* 整数型 int
* 浮点型 double
* 布尔型 bool
* 日期型 date
* 时间戳 timestamp
* 时间型 time
* 定长字符串型 char
* 不定长字符串型 varchar



### 3.3 索引



* 普通索引（INDEX）
* 唯一性索引（UNIQUE）
* 主键（PRIMARY KEY）