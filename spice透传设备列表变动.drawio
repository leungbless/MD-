<mxfile host="app.diagrams.net" modified="2023-03-06T11:04:45.436Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36" etag="3zFpQirj8ap4dsUgYsO_" version="21.0.2" type="github">
  <diagram name="第 1 页" id="BY4z07NkSUgg_BN6G2i4">
    <mxGraphModel dx="2876" dy="1091" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-1" target="41W4eIfwrq1G0Y4Z3EsX-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-1" value="&lt;pre style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 20px;&quot;&gt;&lt;font style=&quot;font-size: 20px;&quot; face=&quot;Helvetica&quot;&gt;g_udev_client_list_devices()&lt;/font&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="141" y="1012.5" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-2" target="41W4eIfwrq1G0Y4Z3EsX-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-2" value="&lt;font color=&quot;#080808&quot;&gt;g_udev_client_initable_init&lt;/font&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8);&quot;&gt;()&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="-169" y="822.5" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-3" target="41W4eIfwrq1G0Y4Z3EsX-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-3" value="&lt;font color=&quot;#080808&quot;&gt;handle_dev_change&lt;/font&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8);&quot;&gt;()&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="431" y="822.5" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-6" target="41W4eIfwrq1G0Y4Z3EsX-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-6" value="&lt;font color=&quot;#080808&quot;&gt;libusb_get_device_list&lt;/font&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8);&quot;&gt;()&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="632" y="1012.5" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-8" target="41W4eIfwrq1G0Y4Z3EsX-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-8" value="获得当前连接到系统的 USB 设备列表" style="text;strokeColor=none;fillColor=#99CCFF;html=1;fontSize=18;fontStyle=0;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="1071" y="1010" width="330" height="65" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-10" target="41W4eIfwrq1G0Y4Z3EsX-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-16" value="返回除USB Root HUB的USB设备个数" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=17;" vertex="1" connectable="0" parent="41W4eIfwrq1G0Y4Z3EsX-15">
          <mxGeometry x="0.0282" y="-3" relative="1" as="geometry">
            <mxPoint x="48" y="3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-10" value="g_udev_skip_search&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8);&quot;&gt;()&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="632" y="1142.5" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-13" target="41W4eIfwrq1G0Y4Z3EsX-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-13" value="跳过USB的 root hub" style="text;strokeColor=none;fillColor=#99CCFF;html=1;fontSize=18;fontStyle=0;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="1071" y="1140" width="330" height="65" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-17" target="41W4eIfwrq1G0Y4Z3EsX-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-17" value="调用g_udev_client_list_devices函数&lt;br&gt;初始化设备列表，在初始化的时候&lt;br&gt;只有执行libusb_get_device_list()失败，&lt;br&gt;才会返回一个负值，&lt;br&gt;然后g_udev_client_initable_init()也随之初始化失败" style="text;strokeColor=none;fillColor=#99CCFF;html=1;fontSize=18;fontStyle=0;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="-720" y="790" width="430" height="125" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-19" target="41W4eIfwrq1G0Y4Z3EsX-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-19" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;font color=&quot;#080808&quot;&gt;g_udev_client_initable_iface_init()&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="-169" y="670" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-21" target="41W4eIfwrq1G0Y4Z3EsX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-21" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;font color=&quot;#080808&quot;&gt;g_udev_client_set_property()&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="150" y="500" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-22" target="41W4eIfwrq1G0Y4Z3EsX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-22" value="wnd_proc&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8);&quot;&gt;()&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="680" y="500" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-26" target="41W4eIfwrq1G0Y4Z3EsX-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-26" value="wnd_proc窗口过程函数，&lt;br&gt;判断消息类型是否为&amp;nbsp;WM_DEVICECHANGE（设备更改消息），是的话就执行&lt;font style=&quot;border-color: var(--border-color); font-size: 20px;&quot; color=&quot;#080808&quot;&gt;handle_dev_change&lt;/font&gt;()&lt;br&gt;最后调用DefWindowProc调用默认窗口过程为应用程序没有处理的窗口消息提供默认的处理" style="text;strokeColor=none;fillColor=#99CCFF;html=1;fontSize=18;fontStyle=0;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="1086" y="484.69" width="844" height="90.62" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-28" target="41W4eIfwrq1G0Y4Z3EsX-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-28" value="当旧的priv-&amp;gt;redirecting为True，&lt;br&gt;新的priv-&amp;gt;redirecting为False的时候，&lt;br&gt;即注入热插拔事件以防我们错过设备更改" style="text;strokeColor=none;fillColor=#99CCFF;html=1;fontSize=18;fontStyle=0;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="-340" y="486.41" width="410" height="87.19" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-30" target="41W4eIfwrq1G0Y4Z3EsX-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-30" value="g_udev_client_class_init&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;font color=&quot;#080808&quot;&gt;()&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="150" y="350" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-32" target="41W4eIfwrq1G0Y4Z3EsX-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-32" value="g_udev_client_new&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;font color=&quot;#080808&quot;&gt;()&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="150" y="200" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-34" target="41W4eIfwrq1G0Y4Z3EsX-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-34" value="spice_usb_device_manager_initable_init&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;font color=&quot;#080808&quot;&gt;()&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="95" y="50" width="440" height="60" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-36" target="41W4eIfwrq1G0Y4Z3EsX-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-36" value="在启动过程中，只执行了一次" style="text;strokeColor=none;fillColor=#99CCFF;html=1;fontSize=18;fontStyle=0;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="-273.5" y="53.199999999999996" width="277" height="53.59" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="41W4eIfwrq1G0Y4Z3EsX-38" target="41W4eIfwrq1G0Y4Z3EsX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41W4eIfwrq1G0Y4Z3EsX-38" value="在 Windows 上，如果与重定向流程并行执行，&lt;br&gt;查询 USB 设备列表可能会返回不一致的结果。 &lt;br&gt;重定向完成后将注入模拟热插拔事件，&lt;br&gt;以处理重定向过程中可能发生的真实设备列表更改。" style="text;strokeColor=none;fillColor=#99CCFF;html=1;fontSize=18;fontStyle=0;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="940" y="800" width="470" height="105" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
